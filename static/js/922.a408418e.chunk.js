"use strict";(self.webpackChunkbooks_shop=self.webpackChunkbooks_shop||[]).push([[922],{647:(e,t,s)=>{e.exports=s.p+"static/media/imgNotFound.298b98203c3825c61303.png"},1374:(e,t,s)=>{function a(e,t){if(!{}.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}s.d(t,{A:()=>j});var r=0;function n(e){return"__private_"+r+++"_"+e}class o{constructor(){this.message=""}setError(e){this.message=e}reset(){this.message=""}validate(e){throw new Error("validate() must be implemented in subclass")}}class i extends o{validate(e){let t=typeof e;return this.reset(),null===e||void 0===e?(this.setError("The value is required!"),!1):"string"!==t||""!==e.trim()||(this.setError("The value is required!"),!1)}}class c extends o{validate(e){return this.reset(),e.length<2?(this.setError("The name is too short!"),!1):!(e.length>10)||(this.setError("The name is too long!"),!1)}}class l extends o{validate(e){return this.reset(),e.length<6?(this.setError("Password must be at least 6 characters long!"),!1):/[A-Z]/.test(e)?!!/[0-9]/.test(e)||(this.setError("Password must contain at least one number!"),!1):(this.setError("Password must contain at least one uppercase letter!"),!1)}}class d extends o{validate(e){return this.reset(),!!/^[^\s@]+@[^\s@]+\.[a-zA-Z]{2,}$/.test(e)||(this.setError("Incorrect email!"),!1)}}class u extends o{validate(e){return this.reset(),!!/^\+?\d{10,15}$/.test(e)||(this.setError("Incorrect phone number!"),!1)}}class h extends o{constructor(){super(...arguments),this.MAX_SIZE=1048576,this.ALLOWED_TYPES=["image/jpeg","image/png","image/webp"]}validate(e){return this.reset(),this.ALLOWED_TYPES.includes(e.type)?!(e.size>this.MAX_SIZE)||(this.setError("The file cannot be larger than 1MB."),!1):(this.setError("Allowed formats: JPG, PNG, WEBP."),!1)}}class m extends o{validate(e){let{newPassword:t,confirm:s}=e;return this.reset(),t===s||(this.setError("New passwords do not match!"),!1)}}class p extends o{validate(e){let{totalCount:t,maxTotalCount:s}=e;return this.reset(),"number"!==typeof t||"number"!==typeof s?(this.setError("Invalid quantity data!"),!1):t<=0?(this.setError("The value is not valid!"),!1):!(t>s)||(this.setError("Only ".concat(s," available!")),!1)}}var f=n("validators");class v{static initialize(){a(v,f)[f]={required:new i,name:new c,password:new l,email:new d,phoneNumber:new u,avatar:new h,passwordEquality:new m,orderQuantity:new p},v.initialize=()=>{}}static select(e){const t=a(v,f)[f][e];if(!t)throw new Error("No validator found: "+e);return t}}Object.defineProperty(v,f,{writable:!0,value:{}});var b=n("config"),g=n("validateObj"),x=n("validateValue");class j{constructor(e){Object.defineProperty(this,x,{value:k}),Object.defineProperty(this,g,{value:y}),Object.defineProperty(this,b,{writable:!0,value:void 0});const t="string"===typeof e||Array.isArray(e)||"object"===typeof e;if(!e)throw new Error("No validation config provided!");if(!t)throw new Error("Config must be string, array, or object!");a(this,b)[b]=e,"string"===typeof e||Array.isArray(e)?this.validate=a(this,x)[x]:this.validate=a(this,g)[g],v.initialize()}}function y(e){if(!e||"object"!==typeof e)throw new Error("Validation failed: data is missing or invalid.");const t={},s=Object.keys(a(this,b)[b]);for(const r of s){let s=a(this,b)[b][r];if(s){"string"===typeof s&&(s=[s]);for(const a of s){const s=v.select(a);if(!s.validate(e[r])){t[r]=s.message;break}}}}return{valid:0===Object.keys(t).length,errors:t}}function k(e){let t="",s=!0,r=a(this,b)[b];"string"===typeof r&&(r=[r]);for(const a of r){const r=v.select(a),n=r.validate(e);if(!n){t=r.message,s=n;break}}return{valid:s,error:t}}},2138:(e,t,s)=>{s.d(t,{A:()=>o,u:()=>n});var a=s(1374);function r(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),r=1;r<t;r++)s[r-1]=arguments[r];const n=Array.isArray(s[0])?s[0]:s;return new a.A(n).validate(e)}function n(e){return r(e,"required","avatar")}function o(e,t){return r({totalCount:e,maxTotalCount:t},"orderQuantity")}},2286:(e,t,s)=>{s.d(t,{A:()=>r});var a=s(579);const r=function(e){let{className:t,message:s,type:r}=e,n=r?"".concat(t," message-").concat(r):t;return n="message"===t?n:"message "+n,(0,a.jsx)("p",{className:n,role:"alert",children:s})}},3653:(e,t,s)=>{s.d(t,{l:()=>n});var a=s(411);const r="/api/books",n={async getAll(e){const t=await(e=>a.A.get(r,{signal:e}))(e);return t.data},async getById(e,t){const s=await((e,t)=>a.A.get("".concat(r,"/").concat(e),{signal:t}))(e,t);return s.data},async create(e,t){const s=await((e,t)=>a.A.post(r,e,{signal:t}))(e,t);return s.data},async update(e,t,s){const n=await((e,t,s)=>a.A.put("".concat(r,"/").concat(e),t,{signal:s}))(e,t,s);return n.data},async delete(e,t){const s=await((e,t)=>a.A.delete("".concat(r,"/").concat(e),{signal:t}))(e,t);return s.data}}},5232:(e,t,s)=>{s.d(t,{S:()=>r});var a=s(5043);function r(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[s,r]=(0,a.useState)(e),n=(0,a.useRef)(null),o=(0,a.useRef)(!0);(0,a.useEffect)(()=>(o.current=!0,()=>{o.current=!1,n.current&&clearTimeout(n.current)}),[]);const i=(0,a.useCallback)((s,a)=>{const i=void 0!==a?a:t;r(s),n.current&&clearTimeout(n.current),null!==i&&void 0!==i&&(n.current=setTimeout(()=>{o.current&&r(e),n.current=null},i))},[t,e]);return{value:s,showValue:i,clearValue:(0,a.useCallback)(()=>{n.current&&clearTimeout(n.current),n.current=null,r(e)},[e])}}},5682:(e,t,s)=>{s.d(t,{_:()=>n});var a=s(5043),r=s(5232);function n(e){const t=(0,a.useMemo)(()=>({text:"",type:""}),[]),{value:s,showValue:n,clearValue:o}=(0,r.S)(t,e),i=(0,a.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n(s=>s.text===e&&s.type===t?s:{text:e,type:t},arguments.length>2?arguments[2]:void 0)},[n]);return{message:s,showMessage:i,clearMessage:o}}},7922:(e,t,s)=>{s.r(t),s.d(t,{default:()=>g});var a=s(3721),r=s(6476),n=s(3653),o=s(5043),i=s(647),c=s(8396),l=s(579);const d=function(e){let{book:{author:t,image:s,title:a,level:r,tags:n,shortDescription:d,description:u}}=e;const[h,m]=(0,o.useState)(!1),p="Click to see ".concat(h?"less":"more...");function f(e){e.stopPropagation(),m(e=>!e)}return(0,l.jsxs)("section",{className:"book-section",children:[(0,l.jsxs)("div",{className:"flex",children:[(0,l.jsx)("div",{className:"img-container fancy-background",children:(0,l.jsx)(c.A,{className:"book-image",src:s||i,alt:"Book image"})}),(0,l.jsxs)("div",{className:"book-info fancy-background",children:[(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"book-span",children:"Book name: "}),(0,l.jsx)("em",{children:a})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"book-span",children:"Book author: "}),(0,l.jsx)("em",{children:t})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"book-span",children:"Book level: "}),(0,l.jsx)("em",{children:r})]}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"book-span",children:"Book tags: "}),(0,l.jsx)("em",{children:n.join(", ")})]})]})]}),(0,l.jsxs)("p",{className:"book-description fancy-background",onClick:e=>{f(e)},children:[(0,l.jsx)("span",{className:"book-span",children:"Description: "}),(0,l.jsxs)("span",{children:[h?u:d," "]}),(0,l.jsx)("button",{type:"button",className:"btn-text",onClick:e=>{f(e)},children:p})]})]})};var u=s(1228),h=s(2138),m=s(5682),p=s(2286),f=s(321);const v=function(e){let{book:t}=e;const{price:s,amount:a,id:r}=t,{cart:n,addToCart:i,loading:c,error:d}=(0,u._)(),v=(null===d||void 0===d?void 0:d.message)||"",b=n.find(e=>e.productId===r),g=!!b,x=(null===b||void 0===b?void 0:b.quantity)||0,j=a-x,[y,k]=(0,o.useState)(1),w=(s*y).toFixed(2),{message:N,showMessage:A,clearMessage:E}=(0,m._)(1e4),{valid:C,error:T}=(0,h.A)(y,j),P=T||v,_=!!P;return(0,o.useEffect)(()=>{_?A(P,"error"):E()},[_,P,A,E]),(0,l.jsxs)("section",{className:"order-section fancy-background",children:[(0,l.jsxs)("div",{className:"order-info-list",children:[(0,l.jsxs)("div",{className:"order-info-item",children:[(0,l.jsx)("span",{className:"item-lable",children:"Price:"}),(0,l.jsxs)("span",{className:"item-value",children:[s,"$"]})]}),(0,l.jsxs)("div",{className:"order-info-item",children:[(0,l.jsx)("label",{className:"item-lable",htmlFor:"count",children:"Count:"}),(0,l.jsxs)("div",{className:"item-value",children:[(0,l.jsx)("button",{type:"button","aria-label":"Decrease count of books",className:"btn-minus btn-effect-3d btn-circle",onClick:function(){k(e=>Math.max(e-1,1))},children:"-"}),(0,l.jsx)("input",{name:"count",className:C?"count":"count invalid-field",id:"count",type:"number",required:!0,step:"1",min:"1",max:j,value:0===y?"":y,onChange:function(e){let t=Number(e.target.value);(t<0||Number.isNaN(t))&&(t=0),k(t)}}),(0,l.jsx)("button",{type:"button","aria-label":"Increase count of books",className:"btn-plus btn-effect-3d btn-circle",onClick:function(){k(e=>e+1)},children:"+"})]})]}),(0,l.jsxs)("div",{className:"order-info-item",children:[(0,l.jsx)("span",{className:"item-lable",children:"Total price:"}),(0,l.jsxs)("span",{className:"item-value",children:[w,"$"]})]})]}),g&&(0,l.jsx)(p.A,{message:"Already in cart: ".concat(x),type:"success"}),(null===N||void 0===N?void 0:N.text)&&(0,l.jsx)(p.A,{message:N.text,type:N.type}),(0,l.jsx)("button",{type:"button",className:"add-button btn-effect-press",disabled:!C||c,onClick:function(){C&&(i(r,y,t),k(1))},children:"Add to cart"}),c&&(0,l.jsx)(f.A,{type:"local"})]})};var b=s(1662);const g=function(){console.log("Book-page render");const{bookID:e}=(0,a.g)(),{data:t,loading:s,error:o,refetch:i}=(0,r.A)({requestFn:n.l.getById,args:[e],auto:!0});return s?(0,l.jsx)(f.A,{type:"named"}):o?(0,l.jsx)(b.A,{error:o,refetch:i}):t&&(0,l.jsxs)("div",{className:"specific-book-container flex",children:[(0,l.jsx)(d,{book:t}),(0,l.jsx)(v,{book:t})]})}},8396:(e,t,s)=>{s.d(t,{A:()=>c});var a=s(2555),r=s(3986),n=s(5043),o=s(579);const i=["src","alt","className"];const c=function(e){let{src:t,alt:s,className:c}=e,l=(0,r.A)(e,i);const[d,u]=(0,n.useState)(!1),[h,m]=(0,n.useState)(!1);return h?(0,o.jsx)("div",{className:"on-error-fallback flex",children:s}):(0,o.jsx)(o.Fragment,{children:(0,o.jsx)("img",(0,a.A)((0,a.A)({src:t,alt:s},l),{},{className:"".concat(c," lazy-img ").concat(d?"loaded":""),onLoad:()=>{u(!0)},onError:()=>{m(!0)}}))})}}}]);
//# sourceMappingURL=922.a408418e.chunk.js.map