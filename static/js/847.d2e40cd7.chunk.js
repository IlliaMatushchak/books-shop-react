"use strict";(self.webpackChunkbooks_shop=self.webpackChunkbooks_shop||[]).push([[847],{1374:(e,r,s)=>{function t(e,r){if(!{}.hasOwnProperty.call(e,r))throw new TypeError("attempted to use private field on non-instance");return e}s.d(r,{A:()=>y});var a=0;function n(e){return"__private_"+a+++"_"+e}class o{constructor(){this.message=""}setError(e){this.message=e}reset(){this.message=""}validate(e){throw new Error("validate() must be implemented in subclass")}}class i extends o{validate(e){let r=typeof e;return this.reset(),null===e||void 0===e?(this.setError("The value is required!"),!1):"string"!==r||""!==e.trim()||(this.setError("The value is required!"),!1)}}class l extends o{validate(e){return this.reset(),e.length<2?(this.setError("The name is too short!"),!1):!(e.length>10)||(this.setError("The name is too long!"),!1)}}class u extends o{validate(e){return this.reset(),e.length<6?(this.setError("Password must be at least 6 characters long!"),!1):/[A-Z]/.test(e)?!!/[0-9]/.test(e)||(this.setError("Password must contain at least one number!"),!1):(this.setError("Password must contain at least one uppercase letter!"),!1)}}class d extends o{validate(e){return this.reset(),!!/^[^\s@]+@[^\s@]+\.[a-zA-Z]{2,}$/.test(e)||(this.setError("Incorrect email!"),!1)}}class c extends o{validate(e){return this.reset(),!!/^\+?\d{10,15}$/.test(e)||(this.setError("Incorrect phone number!"),!1)}}class m extends o{constructor(){super(...arguments),this.MAX_SIZE=1048576,this.ALLOWED_TYPES=["image/jpeg","image/png","image/webp"]}validate(e){return this.reset(),this.ALLOWED_TYPES.includes(e.type)?!(e.size>this.MAX_SIZE)||(this.setError("The file cannot be larger than 1MB."),!1):(this.setError("Allowed formats: JPG, PNG, WEBP."),!1)}}class h extends o{validate(e){let{newPassword:r,confirm:s}=e;return this.reset(),r===s||(this.setError("New passwords do not match!"),!1)}}class v extends o{validate(e){let{totalCount:r,maxTotalCount:s}=e;return this.reset(),"number"!==typeof r||"number"!==typeof s?(this.setError("Invalid quantity data!"),!1):r<=0?(this.setError("The value is not valid!"),!1):!(r>s)||(this.setError(`Only ${s} available!`),!1)}}var p=n("validators");class f{static initialize(){t(f,p)[p]={required:new i,name:new l,password:new u,email:new d,phoneNumber:new c,avatar:new m,passwordEquality:new h,orderQuantity:new v},f.initialize=()=>{}}static select(e){const r=t(f,p)[p][e];if(!r)throw new Error("No validator found: "+e);return r}}Object.defineProperty(f,p,{writable:!0,value:{}});var g=n("config"),w=n("validateObj"),b=n("validateValue");class y{constructor(e){Object.defineProperty(this,b,{value:j}),Object.defineProperty(this,w,{value:x}),Object.defineProperty(this,g,{writable:!0,value:void 0});const r="string"===typeof e||Array.isArray(e)||"object"===typeof e;if(!e)throw new Error("No validation config provided!");if(!r)throw new Error("Config must be string, array, or object!");t(this,g)[g]=e,"string"===typeof e||Array.isArray(e)?this.validate=t(this,b)[b]:this.validate=t(this,w)[w],f.initialize()}}function x(e){if(!e||"object"!==typeof e)throw new Error("Validation failed: data is missing or invalid.");const r={},s=Object.keys(t(this,g)[g]);for(const a of s){let s=t(this,g)[g][a];if(s){"string"===typeof s&&(s=[s]);for(const t of s){const s=f.select(t);if(!s.validate(e[a])){r[a]=s.message;break}}}}return{valid:0===Object.keys(r).length,errors:r}}function j(e){let r="",s=!0,a=t(this,g)[g];"string"===typeof a&&(a=[a]);for(const t of a){const a=f.select(t),n=a.validate(e);if(!n){r=a.message,s=n;break}}return{valid:s,error:r}}},1801:(e,r,s)=>{s.d(r,{A:()=>a});var t=s(5043);const a=function(e){const[r,s]=(0,t.useState)(e.default);return(0,t.useEffect)(()=>{let r;const t=()=>{clearTimeout(r),r=setTimeout(()=>{for(const r in e){if("default"!==r&&window.innerWidth<=r){s(e[r]);break}if("default"===r){s(e[r]);break}}},500)};return t(),window.addEventListener("resize",t),()=>{clearTimeout(r),window.removeEventListener("resize",t)}},[e]),r}},2138:(e,r,s)=>{s.d(r,{A:()=>o,u:()=>n});var t=s(1374);function a(e){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];const n=Array.isArray(s[0])?s[0]:s;return new t.A(n).validate(e)}function n(e){return a(e,"required","avatar")}function o(e,r){return a({totalCount:e,maxTotalCount:r},"orderQuantity")}},2286:(e,r,s)=>{s.d(r,{A:()=>a});var t=s(579);const a=function(e){let{className:r,message:s,type:a}=e,n=a?`${r} message-${a}`:r;return n="message"===r?n:"message "+n,(0,t.jsx)("p",{className:n,role:"alert",children:s})}},5232:(e,r,s)=>{s.d(r,{S:()=>a});var t=s(5043);function a(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const[s,a]=(0,t.useState)(e),n=(0,t.useRef)(null),o=(0,t.useRef)(!0);(0,t.useEffect)(()=>(o.current=!0,()=>{o.current=!1,n.current&&clearTimeout(n.current)}),[]);const i=(0,t.useCallback)((s,t)=>{const i=void 0!==t?t:r;a(s),n.current&&clearTimeout(n.current),null!==i&&void 0!==i&&(n.current=setTimeout(()=>{o.current&&a(e),n.current=null},i))},[r,e]);return{value:s,showValue:i,clearValue:(0,t.useCallback)(()=>{n.current&&clearTimeout(n.current),n.current=null,a(e)},[e])}}},5682:(e,r,s)=>{s.d(r,{_:()=>n});var t=s(5043),a=s(5232);function n(e){const r=(0,t.useMemo)(()=>({text:"",type:""}),[]),{value:s,showValue:n,clearValue:o}=(0,a.S)(r,e),i=(0,t.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n(s=>s.text===e&&s.type===r?s:{text:e,type:r},arguments.length>2?arguments[2]:void 0)},[n]);return{message:s,showMessage:i,clearMessage:o}}},6037:(e,r,s)=>{s.d(r,{A:()=>m});var t=s(5043),a=s(5682),n=s(5767),o=s(8396),i=s(321),l=s(2286),u=s(5536),d=s(2138),c=s(579);const m=function(e){let{className:r="",size:s="16rem"}=e;const{avatar:m,loading:h,error:v,updateAvatar:p,deleteAvatar:f}=(0,n.r)(),{message:g,showMessage:w,clearMessage:b}=(0,a._)(1e4),y=(0,t.useRef)(null),x=(0,t.useRef)(null);(0,t.useEffect)(()=>{v&&w(v.message,"error")},[v,w]);const j=()=>{h||y.current.click()},E=()=>{b(),f()};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)("div",{className:r,style:{width:s},children:[(0,c.jsxs)("div",{className:"avatar-img-container fancy-background",style:{width:"100%",height:s},title:"Click to change avatar","aria-label":"Change avatar",role:"button","aria-pressed":!!m,tabIndex:0,onClick:j,onKeyDown:e=>{h||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),j())},ref:x,children:[(0,c.jsx)(o.A,{src:m||u,style:{lineHeight:s},alt:"User Avatar"}),h?(0,c.jsx)("div",{className:"avatar-overlay",children:(0,c.jsx)(i.A,{type:"small"})}):(0,c.jsxs)("div",{className:"avatar-overlay",children:["\ud83d\udcf7",m&&(0,c.jsx)("button",{type:"button",className:"btn-text btn-effect-3d","aria-label":"Remove avatar",onClick:e=>{e.stopPropagation(),E()},onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),E(),x.current.focus())},children:"\xd7"})]})]}),(null===g||void 0===g?void 0:g.text)&&(0,c.jsx)(l.A,{className:"message",message:g.text,type:g.type})]}),(0,c.jsx)("input",{type:"file",accept:"image/jpeg,image/png,image/webp",ref:y,style:{display:"none"},onChange:async e=>{var r;const s=null===(r=e.target.files)||void 0===r?void 0:r[0];if(!s)return;b();let{valid:t,error:a}=(0,d.u)(s);if(!t)return void w(a,"error");const n=await function(e){return new Promise((r,s)=>{const t=new FileReader;t.onload=()=>r(t.result),t.onerror=s,t.readAsDataURL(e)})}(s);p(n),x.current.blur()}})]})}},6143:(e,r,s)=>{s.d(r,{C8:()=>l,E8:()=>i,eX:()=>n,yC:()=>o});var t=s(1374);function a(e,r){return new t.A(r).validate(e)}function n(e){return a(e,{username:["required","name"],password:["required","password"]})}function o(e){return a(e,{username:["required","name"],password:["required","password"],email:["required","email"],phoneNumber:["required","phoneNumber"]})}function i(e){return a(e,{email:["required","email"],phoneNumber:["required","phoneNumber"]})}function l(e){let{newPassword:r,confirm:s}=e;return a({newPassword:r,confirm:{newPassword:r,confirm:s}},{newPassword:["required","password"],confirm:"passwordEquality"})}},7617:(e,r,s)=>{s.d(r,{T:()=>n});var t=s(5043),a=s(5232);function n(e){const r=(0,t.useMemo)(()=>({messages:{},type:""}),[]),{value:s,showValue:n,clearValue:o}=(0,a.S)(r,e),i=(0,t.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";n(s=>s.type===r&&s.messages===e?s:{messages:e,type:r},arguments.length>2?arguments[2]:void 0)},[n]);return{messages:s.messages,type:s.type,showMessages:i,clearMessages:o}}},8396:(e,r,s)=>{s.d(r,{A:()=>n});var t=s(5043),a=s(579);const n=function(e){let{src:r,alt:s,className:n,...o}=e;const[i,l]=(0,t.useState)(!1),[u,d]=(0,t.useState)(!1);return u?(0,a.jsx)("div",{className:"on-error-fallback flex",children:s}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("img",{src:r,alt:s,...o,className:`${n} lazy-img ${i?"loaded":""}`,onLoad:()=>{l(!0)},onError:()=>{d(!0)}})})}},8847:(e,r,s)=>{s.r(r),s.d(r,{default:()=>w});var t=s(1801),a=s(6037),n=s(5043),o=s(7617),i=s(6440),l=s(4528),u=s(6476),d=s(321),c=s(2286),m=s(6143),h=s(579);const v={username:"",role:"",email:"",phoneNumber:"",gender:"MALE"};const p=function(){const{updateUser:e}=(0,l.A)(),[r,s]=(0,n.useState)(v),[t,a]=(0,n.useState)(!1),{messages:p,type:f,showMessages:g,clearMessages:w}=(0,o.T)(8e3),{data:b,loading:y,error:x,fetch:j}=(0,u.A)({requestFn:i.p.getProfile,onSuccess:e=>{s(e)},auto:!0});(0,n.useEffect)(()=>{x&&g({error:x.message},"error")},[x,g]);const E=e=>{const{name:r,value:t}=e.target;s(e=>({...e,[r]:t}))};return y&&!b?(0,h.jsx)("form",{className:"fancy-background",children:(0,h.jsx)(d.A,{})}):(0,h.jsxs)("form",{className:`fancy-background ${f||""}`,onSubmit:s=>{s.preventDefault(),w();const{valid:t,errors:n}=(0,m.E8)(r);if(!t)return void g(n,"error");const{email:o,phoneNumber:l,gender:u}=r;j({requestFn:i.p.updateProfile,args:[{email:o,phoneNumber:l,gender:u}],onSuccess:r=>{e(r),a(!1),g({success:"Profile updated!"},"success")}})},children:[(0,h.jsx)("h2",{children:"My profile"}),((null===p||void 0===p?void 0:p.success)||(null===p||void 0===p?void 0:p.error))&&(0,h.jsx)(c.A,{message:(null===p||void 0===p?void 0:p.success)||(null===p||void 0===p?void 0:p.error),type:f}),(0,h.jsx)("label",{htmlFor:"user-name",children:"User name"}),(0,h.jsx)("input",{id:"user-name",type:"text",name:"username",value:(null===r||void 0===r?void 0:r.username)||"",disabled:!0}),(0,h.jsx)("label",{htmlFor:"email",children:"Email"}),(0,h.jsx)("input",{id:"email",type:"email",name:"email",placeholder:"Email",value:(null===r||void 0===r?void 0:r.email)||"",onChange:E,required:!0,disabled:!t||y}),(null===p||void 0===p?void 0:p.email)&&(0,h.jsx)(c.A,{message:p.email,type:f}),(0,h.jsx)("label",{htmlFor:"phone-number",children:"Phone Number"}),(0,h.jsx)("input",{id:"phone-number",type:"tel",name:"phoneNumber",placeholder:"Phone Number",value:(null===r||void 0===r?void 0:r.phoneNumber)||"",onChange:E,required:!0,disabled:!t||y}),(null===p||void 0===p?void 0:p.phoneNumber)&&(0,h.jsx)(c.A,{message:p.phoneNumber,type:f}),(0,h.jsx)("label",{htmlFor:"gender",children:"Gender"}),(0,h.jsxs)("select",{id:"gender",name:"gender",value:(null===r||void 0===r?void 0:r.gender)||"",onChange:E,disabled:!t||y,children:[(0,h.jsx)("option",{value:"MALE",children:"Male"}),(0,h.jsx)("option",{value:"FEMALE",children:"Female"})]}),(0,h.jsx)("label",{htmlFor:"role",children:"Role"}),(0,h.jsx)("input",{id:"role",type:"text",name:"role",value:(null===r||void 0===r?void 0:r.role)||"",disabled:!0}),(0,h.jsx)("hr",{}),t?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)("button",{type:"submit",disabled:y,children:"Save"}),(0,h.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),a(!1),s(null!==b&&void 0!==b?b:r),w()},children:"Cancel"})]}):(0,h.jsx)("button",{type:"button",onClick:e=>{e.preventDefault(),a(!0)},children:"Edit"}),y&&(0,h.jsx)(d.A,{type:"local"})]})},f={oldPassword:"",newPassword:"",confirm:""};const g=function(){const[e,r]=(0,n.useState)(f),{messages:s,type:t,showMessages:a,clearMessages:l}=(0,o.T)(8e3),{loading:v,error:p,fetch:g}=(0,u.A)();(0,n.useEffect)(()=>{p&&a({error:p.message},"error")},[p,a]);const w=e=>{const{name:s,value:t}=e.target;r(e=>({...e,[s]:t}))};return(0,h.jsxs)("form",{className:`fancy-background ${t||""}`,onSubmit:s=>{s.preventDefault(),l();const{valid:t,errors:n}=(0,m.C8)(e);t?g({requestFn:i.p.changePassword,args:[{oldPassword:e.oldPassword,newPassword:e.newPassword}],onSuccess:e=>{a({success:e.message||"Password changed!"},"success"),r(f)}}):a(n,"error")},children:[(0,h.jsx)("h2",{children:"Change password"}),((null===s||void 0===s?void 0:s.success)||(null===s||void 0===s?void 0:s.error))&&(0,h.jsx)(c.A,{message:(null===s||void 0===s?void 0:s.success)||(null===s||void 0===s?void 0:s.error),type:t}),(0,h.jsx)("input",{type:"password",name:"oldPassword",placeholder:"Old password",value:e.oldPassword,onChange:w,required:!0,disabled:v}),(0,h.jsx)("input",{type:"password",name:"newPassword",placeholder:"New password",value:e.newPassword,onChange:w,required:!0,disabled:v}),(null===s||void 0===s?void 0:s.newPassword)&&(0,h.jsx)(c.A,{message:s.newPassword,type:t}),(0,h.jsx)("input",{type:"password",name:"confirm",placeholder:"Confirm password",value:e.confirm,onChange:w,required:!0,disabled:v}),(null===s||void 0===s?void 0:s.confirm)&&(0,h.jsx)(c.A,{message:s.confirm,type:t}),(0,h.jsx)("hr",{}),(0,h.jsx)("button",{type:"submit",disabled:v,children:"Change"}),v&&(0,h.jsx)(d.A,{type:"local"})]})};function w(){const e=(0,t.A)({320:"12.5rem",480:"14rem",default:"16rem"});return(0,h.jsxs)("div",{className:"profile-container flex",children:[(0,h.jsx)(a.A,{className:"avatar",size:e}),(0,h.jsx)(p,{}),(0,h.jsx)(g,{})]})}}}]);
//# sourceMappingURL=847.d2e40cd7.chunk.js.map